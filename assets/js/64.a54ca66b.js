(window.webpackJsonp=window.webpackJsonp||[]).push([[64],{474:function(s,t,a){"use strict";a.r(t);var e=a(2),r=Object(e.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"功能实现"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#功能实现"}},[s._v("#")]),s._v(" 功能实现")]),s._v(" "),t("h2",{attrs:{id:"用户注册、登录"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#用户注册、登录"}},[s._v("#")]),s._v(" 用户注册、登录")]),s._v(" "),t("ol",[t("li",[s._v("用户注册 user/register 必填邮箱和密码")]),s._v(" "),t("li",[s._v("邮箱发送验证码 email/code 验证码有效期5min，存在redis中")]),s._v(" "),t("li",[s._v("用户输入验证码后调用注册接口，验证成功后用户注册且返回token")]),s._v(" "),t("li",[s._v("用户登录 user/login")])]),s._v(" "),t("p",[s._v("用户表 user")]),s._v(" "),t("h2",{attrs:{id:"用户好友"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#用户好友"}},[s._v("#")]),s._v(" 用户好友")]),s._v(" "),t("h3",{attrs:{id:"用户申请好友"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#用户申请好友"}},[s._v("#")]),s._v(" 用户申请好友")]),s._v(" "),t("ol",[t("li",[s._v("申请好友 post-friend/apply")]),s._v(" "),t("li",[s._v("好友申请列表 get-friend/apply/list")]),s._v(" "),t("li",[s._v("同意好友申请 post-friend/approve")]),s._v(" "),t("li",[s._v("好友列表 post-friend/list")]),s._v(" "),t("li",[s._v("是否好友 get-friend/check")]),s._v(" "),t("li",[s._v("删除好友 post-friend/delete")])]),s._v(" "),t("p",[s._v("用户申请表 user_apply")]),s._v(" "),t("p",[s._v("好友表 friend")]),s._v(" "),t("h2",{attrs:{id:"消息"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#消息"}},[s._v("#")]),s._v(" 消息")]),s._v(" "),t("h3",{attrs:{id:"消息发送"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#消息发送"}},[s._v("#")]),s._v(" 消息发送")]),s._v(" "),t("h4",{attrs:{id:"问题"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#问题"}},[s._v("#")]),s._v(" 问题")]),s._v(" "),t("div",{staticClass:"language-go line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-go"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 如何优雅实现根据msgType将Body转换为TextMsgBody/ImageMsgBody")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("type")]),s._v(" ChatMsgReq "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("struct")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  g"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Meta  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('`path:"/chat/msg" method:"post" tags:"Chat" summary:"发送消息"`')]),s._v("\n  RoomId  "),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("string")]),s._v("      "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('`json:"roomId"       description:"房间id" v:"required#房间id必填"`')]),s._v("\n  MsgType "),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("int")]),s._v("         "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('`json:"msgType"      description:"消息类型" v:"required#消息类型必填"`')]),s._v("\n  Body    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("interface")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('`json:"body"         description:"消息体" v:"required#消息体必填"`')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("h4",{attrs:{id:"难点"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#难点"}},[s._v("#")]),s._v(" 难点")]),s._v(" "),t("ol",[t("li",[s._v("请求参数的body根据请求参数msgType转换成对应的消息类型body，踩了json.Number转换的坑，gpt输出都是什么float，int类型，详见(ParseBody方法)")]),s._v(" "),t("li",[s._v("将json数据格式插入到数据库，因为orm的数据类型是string，导致"),t("code",[s._v('""')]),s._v("，就会报错，需要自己更换成"),t("code",[s._v('"{}"')]),s._v("，当然这也是因为自己没有过滤空值。最后填充扩展消息的时候需要自己主动序列化，这样插入消息才正确，但是取出的转换还没有写")]),s._v(" "),t("li",[s._v("更新消息的时候，忘记主键重复(Where)，空值过滤(OmitEmpty)等条件")]),s._v(" "),t("li",[s._v("注意事务，消息插入和更新，如果失败，则同时回滚数据")])])])}),[],!1,null,null,null);t.default=r.exports}}]);
(window.webpackJsonp=window.webpackJsonp||[]).push([[77],{486:function(s,a,t){"use strict";t.r(a);var n=t(2),e=Object(n.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"nsq"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#nsq"}},[s._v("#")]),s._v(" nsq")]),s._v(" "),a("h2",{attrs:{id:"特点"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#特点"}},[s._v("#")]),s._v(" 特点")]),s._v(" "),a("ol",[a("li",[s._v("基于内存的消息队列")]),s._v(" "),a("li",[s._v("分布式和去中心化拓扑结构，无单点故障")]),s._v(" "),a("li",[s._v("可以处理极大的数据量")])]),s._v(" "),a("h2",{attrs:{id:"应用场景"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#应用场景"}},[s._v("#")]),s._v(" 应用场景")]),s._v(" "),a("ol",[a("li",[s._v("异步处理，非关键流程已不画。提高系统的响应时间和健壮性")]),s._v(" "),a("li",[s._v("应用解耦，订阅订单系统")]),s._v(" "),a("li",[s._v("流量削峰，根据规则读取秒杀请求")])]),s._v(" "),a("h2",{attrs:{id:"架构和原理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#架构和原理"}},[s._v("#")]),s._v(" 架构和原理")]),s._v(" "),a("h3",{attrs:{id:"消息队列成员"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#消息队列成员"}},[s._v("#")]),s._v(" 消息队列成员")]),s._v(" "),a("ol",[a("li",[s._v("nsqd，负责消息接收，保存以及发送消息给消费者的进程")]),s._v(" "),a("li",[s._v("nsqlookup，负责维护所有nsqd的状态，提供服务发现的进程")]),s._v(" "),a("li",[s._v("nsqadmin，web管理平台，试试监控集群以及执行各种管理任务")])]),s._v(" "),a("h3",{attrs:{id:"消息队列中的概念"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#消息队列中的概念"}},[s._v("#")]),s._v(" 消息队列中的概念")]),s._v(" "),a("ol",[a("li",[s._v("Topic概念，对应一个具体的队列，比如订单数据放到order_queue这个topic")]),s._v(" "),a("li",[s._v("Channel概念，每个消费者对应一个channel。实现消息可重复消费")])]),s._v(" "),a("h3",{attrs:{id:"实现消息队列的消费"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#实现消息队列的消费"}},[s._v("#")]),s._v(" 实现消息队列的消费")]),s._v(" "),a("p",[s._v("一个队列A可以有多个通道1、2、3，一个通道可以有多个消费者a、b、c。")]),s._v(" "),a("h2",{attrs:{id:"特性"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#特性"}},[s._v("#")]),s._v(" 特性")]),s._v(" "),a("ol",[a("li",[s._v("消息默认不持久化，可以配置成持久化")]),s._v(" "),a("li",[s._v("每条消息至少传递一次")]),s._v(" "),a("li",[s._v("消息不保证有序")])]),s._v(" "),a("h2",{attrs:{id:"接收和发送消息流程"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#接收和发送消息流程"}},[s._v("#")]),s._v(" 接收和发送消息流程")]),s._v(" "),a("p",[s._v("input Chan -> in-Memory Chan-> output Chan\ndisk Memory")]),s._v(" "),a("p",[s._v("如果内存满了，会存到磁盘中")]),s._v(" "),a("h2",{attrs:{id:"搭建以及使用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#搭建以及使用"}},[s._v("#")]),s._v(" 搭建以及使用")]),s._v(" "),a("p",[s._v("要在 Docker 上安装并启动 NSQ 消息队列，你需要使用 "),a("code",[s._v("docker-compose")]),s._v(" 或者直接通过 "),a("code",[s._v("docker")]),s._v(" 命令来运行 NSQ 的容器。下面是如何使用 Docker 来部署 NSQ 的步骤。")]),s._v(" "),a("h3",{attrs:{id:"步骤-1-使用-docker-compose-部署-nsq"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#步骤-1-使用-docker-compose-部署-nsq"}},[s._v("#")]),s._v(" 步骤 1: 使用 "),a("code",[s._v("docker-compose")]),s._v(" 部署 NSQ")]),s._v(" "),a("p",[s._v("NSQ 是由多个组件组成的消息队列系统，通常包括 "),a("strong",[s._v("nsqd")]),s._v("、"),a("strong",[s._v("nsqlookupd")]),s._v(" 和 "),a("strong",[s._v("nsqadmin")]),s._v("。以下是一个简单的 "),a("code",[s._v("docker-compose.yml")]),s._v(" 文件，可以用来启动这些组件。")]),s._v(" "),a("h4",{attrs:{id:"_1-1-创建-docker-compose-yml-文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-创建-docker-compose-yml-文件"}},[s._v("#")]),s._v(" 1.1 创建 "),a("code",[s._v("docker-compose.yml")]),s._v(" 文件")]),s._v(" "),a("p",[s._v("在项目目录下创建一个名为 "),a("code",[s._v("docker-compose.yml")]),s._v(" 的文件，内容如下：")]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("version")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'3'")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("services")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("nsqlookupd")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nsqio/nsq\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("container_name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nsqlookupd\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ports")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"4160:4160"')]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# nsqlookupd HTTP 服务")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"4161:4161"')]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# nsqlookupd TCP 服务")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("command")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" /nsqlookupd\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("restart")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" always\n\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("nsqd")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nsqio/nsq\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("container_name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nsqd\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ports")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"4150:4150"')]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# nsqd TCP 服务")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"4151:4151"')]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# nsqd HTTP 服务")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("command")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" /nsqd "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("lookupd"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("tcp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("address=nsqlookupd"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("4160 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("lookupd"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("tcp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("address=x x"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("4160 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("broadcast"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("address=xx.xx.xx.xx "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 增加address，防止容器名变成host名")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("depends_on")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" nsqlookupd\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("restart")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" always\n\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("nsqadmin")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nsqio/nsq\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("container_name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nsqadmin\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ports")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"4171:4171"')]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# nsqadmin HTTP 服务")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("command")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" /nsqadmin "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("lookupd"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("http"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("address=nsqlookupd"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4161")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("depends_on")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" nsqlookupd\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("restart")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" always\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br")])]),a("h4",{attrs:{id:"_1-2-启动服务"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-启动服务"}},[s._v("#")]),s._v(" 1.2 启动服务")]),s._v(" "),a("p",[s._v("在 "),a("code",[s._v("docker-compose.yml")]),s._v(" 文件所在目录打开终端，执行以下命令来启动 NSQ 服务：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker-compose")]),s._v(" up "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-d")]),s._v("\nCONTAINER ID   IMAGE       COMMAND                   CREATED          STATUS          PORTS                                                                                         NAMES\ncccc1a29501d   nsqio/nsq   "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/nsqadmin --lookupd…"')]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("18")]),s._v(" seconds ago   Up "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("17")]),s._v(" seconds   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4150")]),s._v("-4151/tcp, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4160")]),s._v("-4161/tcp, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4170")]),s._v("/tcp, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0:4171-"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4171")]),s._v("/tcp, :::4171-"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4171")]),s._v("/tcp             nsqadmin\n1b23d7df5580   nsqio/nsq   "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/nsqd --lookupd-tcp…"')]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("18")]),s._v(" seconds ago   Up "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("17")]),s._v(" seconds   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4160")]),s._v("-4161/tcp, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0:4150-4151-"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4150")]),s._v("-4151/tcp, :::4150-4151-"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4150")]),s._v("-4151/tcp, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4170")]),s._v("-4171/tcp   nsqd\n57301e25354b   nsqio/nsq   "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/nsqlookupd"')]),s._v("             "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("19")]),s._v(" seconds ago   Up "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("17")]),s._v(" seconds   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4150")]),s._v("-4151/tcp, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4170")]),s._v("-4171/tcp, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0:4160-4161-"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4160")]),s._v("-4161/tcp, :::4160-4161-"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4160")]),s._v("-4161/tcp   nsqlookupd\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[s._v("这将会在后台启动 "),a("code",[s._v("nsqlookupd")]),s._v("、"),a("code",[s._v("nsqd")]),s._v(" 和 "),a("code",[s._v("nsqadmin")]),s._v(" 三个容器。")]),s._v(" "),a("ul",[a("li",[a("strong",[s._v("nsqlookupd")]),s._v("：负责服务发现，NSQD 通过它来发现其他节点。")]),s._v(" "),a("li",[a("strong",[s._v("nsqd")]),s._v("：消息队列的核心，负责消息的接收、存储和分发。")]),s._v(" "),a("li",[a("strong",[s._v("nsqadmin")]),s._v("：Web 管理界面，可以通过浏览器访问它来查看队列状态、消息消费等信息。")])]),s._v(" "),a("h4",{attrs:{id:"_1-3-访问-web-管理界面"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-3-访问-web-管理界面"}},[s._v("#")]),s._v(" 1.3 访问 Web 管理界面")]),s._v(" "),a("ul",[a("li",[a("strong",[s._v("NSQ Admin UI")]),s._v("：可以通过浏览器访问 "),a("code",[s._v("http://xx.xx.xx.xx:4171")]),s._v(" 来访问 NSQ 的 Web 管理界面。")]),s._v(" "),a("li",[a("strong",[s._v("NSQD HTTP 接口")]),s._v("：可以通过 "),a("code",[s._v("http://xx.xx.xx.xx:4151")]),s._v(" 来访问 NSQD 提供的 HTTP 接口，用于管理队列等操作。")])]),s._v(" "),a("h3",{attrs:{id:"步骤-2-使用-docker-命令单独启动-nsq"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#步骤-2-使用-docker-命令单独启动-nsq"}},[s._v("#")]),s._v(" 步骤 2: 使用 Docker 命令单独启动 NSQ")]),s._v(" "),a("p",[s._v("如果你不想使用 "),a("code",[s._v("docker-compose")]),s._v("，你也可以单独使用 Docker 命令来启动 NSQ 服务。下面是使用 Docker 启动 "),a("code",[s._v("nsqlookupd")]),s._v("、"),a("code",[s._v("nsqd")]),s._v(" 和 "),a("code",[s._v("nsqadmin")]),s._v(" 的命令。")]),s._v(" "),a("h4",{attrs:{id:"_2-1-启动-nsqlookupd"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-启动-nsqlookupd"}},[s._v("#")]),s._v(" 2.1 启动 "),a("code",[s._v("nsqlookupd")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-d")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--name")]),s._v(" nsqlookupd "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4160")]),s._v(":4160 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4161")]),s._v(":4161 nsqio/nsq /nsqlookupd\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h4",{attrs:{id:"_2-2-启动-nsqd"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-启动-nsqd"}},[s._v("#")]),s._v(" 2.2 启动 "),a("code",[s._v("nsqd")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-d")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--name")]),s._v(" nsqd "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4150")]),s._v(":4150 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4151")]),s._v(":4151 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--link")]),s._v(" nsqlookupd:nsqlookupd nsqio/nsq /nsqd --lookupd-tcp-address"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("nsqlookupd:4160\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h4",{attrs:{id:"_2-3-启动-nsqadmin"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-启动-nsqadmin"}},[s._v("#")]),s._v(" 2.3 启动 "),a("code",[s._v("nsqadmin")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-d")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--name")]),s._v(" nsqadmin "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4171")]),s._v(":4171 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--link")]),s._v(" nsqlookupd:nsqlookupd nsqio/nsq /nsqadmin --lookupd-http-address"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("nsqlookupd:4161\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h3",{attrs:{id:"步骤-3-测试-nsq-服务"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#步骤-3-测试-nsq-服务"}},[s._v("#")]),s._v(" 步骤 3: 测试 NSQ 服务")]),s._v(" "),a("p",[s._v("你可以使用 NSQ 提供的工具或者自己编写程序来测试消息的发布和消费。")]),s._v(" "),a("ol",[a("li",[a("p",[a("strong",[s._v("发布消息")]),s._v("：\n使用 "),a("code",[s._v("nsq_pub")]),s._v(" 命令（NSQ 的命令行工具），你可以发布一条消息到 "),a("code",[s._v("nsqd")]),s._v("：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-n")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Hello, NSQ!"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("nc")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-q")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" xx.xx.xx.xx "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4150")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("这条命令会把消息 "),a("code",[s._v("Hello, NSQ!")]),s._v(" 发布到 "),a("code",[s._v("nsqd")]),s._v(" 服务。")])]),s._v(" "),a("li",[a("p",[a("strong",[s._v("消费消息")]),s._v("：\n使用 "),a("code",[s._v("nsq_sub")]),s._v(" 命令来订阅并消费消息：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("nc")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-lk")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4150")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" nsq_sub "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-t")]),s._v(" my_topic "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" my_channel "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-addr")]),s._v(" xx.xx.xx.xx:4150\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])])])]),s._v(" "),a("h3",{attrs:{id:"步骤-4-停止和删除容器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#步骤-4-停止和删除容器"}},[s._v("#")]),s._v(" 步骤 4: 停止和删除容器")]),s._v(" "),a("p",[s._v("如果你不再需要运行这些容器，可以使用以下命令停止并删除它们：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker-compose")]),s._v(" down\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("或者，单独删除容器：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" stop nsqlookupd nsqd nsqadmin\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" nsqlookupd nsqd nsqadmin\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h3",{attrs:{id:"总结"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#总结"}},[s._v("#")]),s._v(" 总结")]),s._v(" "),a("ul",[a("li",[s._v("使用 "),a("code",[s._v("docker-compose")]),s._v(" 是部署多个容器（如 "),a("code",[s._v("nsqlookupd")]),s._v("、"),a("code",[s._v("nsqd")]),s._v(" 和 "),a("code",[s._v("nsqadmin")]),s._v("）的最佳方式，可以通过单个文件管理所有服务。")]),s._v(" "),a("li",[s._v("也可以使用 Docker 命令分别启动每个组件。")]),s._v(" "),a("li",[s._v("使用 Web 界面 "),a("code",[s._v("http://xx.xx.xx.xx:4171")]),s._v(" 监控和管理 NSQ 服务。")])])])}),[],!1,null,null,null);a.default=e.exports}}]);